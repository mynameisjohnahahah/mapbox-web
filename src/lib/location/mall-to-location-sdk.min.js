!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("axios"),require("dayjs"),require("uuid"),require("crypto-js/hmac-sha1"),require("crypto-js/enc-base64"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["exports","axios","dayjs","uuid","crypto-js/hmac-sha1","crypto-js/enc-base64","rxjs","rxjs/operators"],i):i((t=t||self)["mall-to-location-sdk"]={},t.axios,t.dayjs,t.uuid,t.hex_hmac,t.Base64,t.rxjs,t.operators)}(this,function(t,e,r,c,u,l,p,h){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,u=u&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u,l=l&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l;var d=function(){return(d=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var o in i=arguments[n])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t}).apply(this,arguments)};function i(t,a,r,c){return new(r=r||Promise)(function(n,i){function e(t){try{s(c.next(t))}catch(t){i(t)}}function o(t){try{s(c.throw(t))}catch(t){i(t)}}function s(t){var i;t.done?n(t.value):((i=t.value)instanceof r?i:new r(function(t){t(i)})).then(e,o)}s((c=c.apply(t,a||[])).next())})}function m(n,e){var o,s,a,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:i(0),throw:i(1),return:i(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function i(i){return function(t){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,s&&(a=2&i[0]?s.return:i[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,i[1])).done)return a;switch(s=0,(i=a?[2&i[0],a.value]:i)[0]){case 0:case 1:a=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,s=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!((a=0<(a=r.trys).length&&a[a.length-1])||6!==i[0]&&2!==i[0])){r=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){r.label=i[1];break}if(6===i[0]&&r.label<a[1]){r.label=a[1],a=i;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(i);break}a[2]&&r.ops.pop(),r.trys.pop();continue}i=e.call(n,r)}catch(t){i=[6,t],s=0}finally{o=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,t])}}}function a(h){return new Promise(function(t){for(var i=h.acceleration,n=h.accelerationGravity,e=h.timestamp,o=0,s=0,a=0;a<3;a+=1){var r=i[a]-n[a];o+=r*i[a],s+=r*r}var c=o/Math.sqrt(s);y.push(c),10<y.length&&y.shift();var u,l,p=1<Math.max.apply(null,y);return 1==(u=c,l=1,b.filtered.shift(),Math.abs(u-b.avg_filter)>+b.std_filter?((u<=b.avg_filter||u<1)&&(l=-1),c=.1*u+.9*b.filtered[8],b.filtered.push(c)):(l=0,b.filtered.push(u)),b.avg_filter=b.filtered.reduce(function(t,i){return t+i},0)/10,b.std_filter=Math.sqrt(b.filtered.reduce(function(t,i){return t.concat(Math.pow(i-b.avg_filter,2))},[]).reduce(function(t,i){return t+i/10},0)),l)&&600<e-b.timestamp?(b.timestamp=e,t({walk:!0,motion:p})):t({walk:!1,motion:p})})}var n=(o.prototype.init=function(){var i=this;e.interceptors.request.use(function(t){return t.baseURL=i.host,t.headers=Object.assign(t.headers,i.genHeader(Object.assign({},t.params||{},t.data||{}))),t},function(t){return Promise.reject(t)})},o.prototype.genHeader=function(t){var i=r().format("YYYY-MM-DD HH:mm:ss"),n=c.v4(),e=this.AppId,o=this.uuid,s=d({timestamp:i,signature_nonce:n,app_id:e,uuid:o},t),a={};Object.keys(s).sort().forEach(function(t){a[t]=s[t]});t=Object.keys(a).map(function(t){return t+"="+a[t]}).join("&"),t=encodeURIComponent(t),t=u(t,this.AppSecret),t=l.stringify(t);return{Signature:encodeURIComponent(t),"App-Id":e,"Signature-Nonce":n,UUID:o,Timestamp:i,Accept:"application/json","Signature-Version":4}},o.prototype.getPosition=function(n){return void 0===n&&(n={openid:"omR735dF01pxo3SDxlS5SVDzcx_8"}),i(this,void 0,void 0,function(){var i;return m(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e.get("/api/lbs/asyn/location",{params:n})];case 1:return[2,t.sent().data];case 2:return i=t.sent(),console.error("定位失败: "+i.message||i),[2,void 0];case 3:return[2]}})})},o),f=self,b={filtered:new Array(10).fill(1),avg_filter:1,std_filter:0,timestamp:0},y=[];function o(t){this.host="",this.AppId=t.appId,this.AppSecret=t.appSecret,this.uuid=t.uuid,this.host=t.host||"https://test-easy.mall-to.com",this.init()}f.addEventListener("message",function(s){return i(void 0,void 0,void 0,function(){var i,e,o;return m(this,function(t){switch(t.label){case 0:return o=s.data,[4,(n=o,new Promise(function(t){var i=new FileReader;i.readAsText(n,"utf-8"),i.onload=function(){t(JSON.parse(i.result))}}))];case 1:return"motion"===(i=t.sent(),e=null,o.type)?[3,2]:[3,4];case 2:return[4,a(i.data)];case 3:return e=t.sent(),[3,4];case 4:return e&&(e={id:i.id,data:e},o=new Blob([JSON.stringify(e)],{type:o.type}),f.postMessage(o)),[2]}var n})})});var v,g,s=(v=null,0,function(t){return g=g||(e=void 0===(i=v)?null:i,n=(i=function(t){var i=atob(s);if(t){for(var n=new Uint8Array(i.length),e=0,o=i.length;e<o;++e)n[e]=i.charCodeAt(e);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return i}(void 0!==(n=!(s="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwp2YXIgd29ya2VyX2NvZGU9ZnVuY3Rpb24oZSl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGQocil7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGUpe3ZhciB0PW5ldyBGaWxlUmVhZGVyO3QucmVhZEFzVGV4dChyLCJ1dGYtOCIpLHQub25sb2FkPWZ1bmN0aW9uKCl7ZShKU09OLnBhcnNlKHQucmVzdWx0KSl9fSl9ZnVuY3Rpb24gcChkKXtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWQuYWNjZWxlcmF0aW9uLHI9ZC5hY2NlbGVyYXRpb25HcmF2aXR5LG49ZC50aW1lc3RhbXAsYT0wLGk9MCxvPTA7bzwzO28rPTEpe3ZhciBsPXRbb10tcltvXTthKz1sKnRbb10saSs9bCpsfXZhciB1PWEvTWF0aC5zcXJ0KGkpO3kucHVzaCh1KSwxMDx5Lmxlbmd0aCYmeS5zaGlmdCgpO3ZhciBzLGMsZj0xPE1hdGgubWF4LmFwcGx5KG51bGwseSk7cmV0dXJuIDE9PShzPXUsYz0xLHYuZmlsdGVyZWQuc2hpZnQoKSxNYXRoLmFicyhzLXYuYXZnX2ZpbHRlcik+K3Yuc3RkX2ZpbHRlcj8oKHM8PXYuYXZnX2ZpbHRlcnx8czwxKSYmKGM9LTEpLHU9LjEqcysuOSp2LmZpbHRlcmVkWzhdLHYuZmlsdGVyZWQucHVzaCh1KSk6KGM9MCx2LmZpbHRlcmVkLnB1c2gocykpLHYuYXZnX2ZpbHRlcj12LmZpbHRlcmVkLnJlZHVjZShmdW5jdGlvbihlLHQpe3JldHVybiBlK3R9LDApLzEwLHYuc3RkX2ZpbHRlcj1NYXRoLnNxcnQodi5maWx0ZXJlZC5yZWR1Y2UoZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5jb25jYXQoTWF0aC5wb3codC12LmF2Z19maWx0ZXIsMikpfSxbXSkucmVkdWNlKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC8xMH0sMCkpLGMpJiY2MDA8bi12LnRpbWVzdGFtcD8odi50aW1lc3RhbXA9bixlKHt3YWxrOiEwLG1vdGlvbjpmfSkpOmUoe3dhbGs6ITEsbW90aW9uOmZ9KX0pfXZhciBoPXNlbGYsdj17ZmlsdGVyZWQ6bmV3IEFycmF5KDEwKS5maWxsKDEpLGF2Z19maWx0ZXI6MSxzdGRfZmlsdGVyOjAsdGltZXN0YW1wOjB9LHk9W107cmV0dXJuIGguYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsZnVuY3Rpb24oZil7cmV0dXJuIHU9ZnVuY3Rpb24oKXt2YXIgdCxyLG4sYSxpLG8sbCx1LHMsZTtyZXR1cm4gYT10aGlzLGk9ZnVuY3Rpb24oZSl7c3dpdGNoKGUubGFiZWwpe2Nhc2UgMDpyZXR1cm4gbj1mLmRhdGEsWzQsZChuKV07Y2FzZSAxOnJldHVybiJtb3Rpb24iPT09KHQ9ZS5zZW50KCkscj1udWxsLG4udHlwZSk/WzMsMl06WzMsNF07Y2FzZSAyOnJldHVybls0LHAodC5kYXRhKV07Y2FzZSAzOnJldHVybiByPWUuc2VudCgpLFszLDRdO2Nhc2UgNDpyZXR1cm4gciYmKHI9e2lkOnQuaWQsZGF0YTpyfSxuPW5ldyBCbG9iKFtKU09OLnN0cmluZ2lmeShyKV0se3R5cGU6bi50eXBlfSksaC5wb3N0TWVzc2FnZShuKSksWzJdfX0scz17bGFiZWw6MCxzZW50OmZ1bmN0aW9uKCl7aWYoMSZ1WzBdKXRocm93IHVbMV07cmV0dXJuIHVbMV19LHRyeXM6W10sb3BzOltdfSxlPXtuZXh0OmMoMCksdGhyb3c6YygxKSxyZXR1cm46YygyKX0sImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmKGVbU3ltYm9sLml0ZXJhdG9yXT1mdW5jdGlvbigpe3JldHVybiB0aGlzfSksZTtmdW5jdGlvbiBjKHQpe3JldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7aWYobyl0aHJvdyBuZXcgVHlwZUVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuIik7Zm9yKDtzOyl0cnl7aWYobz0xLGwmJih1PTImdFswXT9sLnJldHVybjp0WzBdP2wudGhyb3d8fCgodT1sLnJldHVybikmJnUuY2FsbChsKSwwKTpsLm5leHQpJiYhKHU9dS5jYWxsKGwsdFsxXSkpLmRvbmUpcmV0dXJuIHU7c3dpdGNoKGw9MCwodD11P1syJnRbMF0sdS52YWx1ZV06dClbMF0pe2Nhc2UgMDpjYXNlIDE6dT10O2JyZWFrO2Nhc2UgNDpyZXR1cm4gcy5sYWJlbCsrLHt2YWx1ZTp0WzFdLGRvbmU6ITF9O2Nhc2UgNTpzLmxhYmVsKyssbD10WzFdLHQ9WzBdO2NvbnRpbnVlO2Nhc2UgNzp0PXMub3BzLnBvcCgpLHMudHJ5cy5wb3AoKTtjb250aW51ZTtkZWZhdWx0OmlmKCEoKHU9MDwodT1zLnRyeXMpLmxlbmd0aCYmdVt1Lmxlbmd0aC0xXSl8fDYhPT10WzBdJiYyIT09dFswXSkpe3M9MDtjb250aW51ZX1pZigzPT09dFswXSYmKCF1fHx0WzFdPnVbMF0mJnRbMV08dVszXSkpe3MubGFiZWw9dFsxXTticmVha31pZig2PT09dFswXSYmcy5sYWJlbDx1WzFdKXtzLmxhYmVsPXVbMV0sdT10O2JyZWFrfWlmKHUmJnMubGFiZWw8dVsyXSl7cy5sYWJlbD11WzJdLHMub3BzLnB1c2godCk7YnJlYWt9dVsyXSYmcy5vcHMucG9wKCkscy50cnlzLnBvcCgpO2NvbnRpbnVlfXQ9aS5jYWxsKGEscyl9Y2F0Y2goZSl7dD1bNixlXSxsPTB9ZmluYWxseXtvPXU9MH1pZig1JnRbMF0pdGhyb3cgdFsxXTtyZXR1cm57dmFsdWU6dFswXT90WzFdOnZvaWQgMCxkb25lOiEwfX0oW3QsZV0pfX19LG5ldyhsPShsPW89ZT12b2lkIDApfHxQcm9taXNlKShmdW5jdGlvbihyLHQpe2Z1bmN0aW9uIG4oZSl7dHJ5e2kodS5uZXh0KGUpKX1jYXRjaChlKXt0KGUpfX1mdW5jdGlvbiBhKGUpe3RyeXtpKHUudGhyb3coZSkpfWNhdGNoKGUpe3QoZSl9fWZ1bmN0aW9uIGkoZSl7dmFyIHQ7ZS5kb25lP3IoZS52YWx1ZSk6KCh0PWUudmFsdWUpaW5zdGFuY2VvZiBsP3Q6bmV3IGwoZnVuY3Rpb24oZSl7ZSh0KX0pKS50aGVuKG4sYSl9aSgodT11LmFwcGx5KGUsb3x8W10pKS5uZXh0KCkpfSk7dmFyIGUsbyxsLHV9KSxlLk1vdGlvblNlbnNvcj1wLGUuYW5hbHlzaXM9ZCxlfSh7fSk7Cgo="))&&n)).indexOf("\n",10)+1,e=i.substring(n)+(e?"//# sourceMappingURL="+e:""),e=new Blob([e],{type:"application/javascript"}),URL.createObjectURL(e)),new Worker(g,t);var s,i,n,e});function Z(t){var i=20037508.34*t[0]/180,t=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return[i,t*=20037508.34/180]}function W(t){var i=t[0]/20037508.34*180,t=t[1]/20037508.34*180;return[i,t=180/Math.PI*(2*Math.atan(Math.exp(t*Math.PI/180))-Math.PI/2)]}var S=(V.prototype.addTask=function(e,o){var s=this;return new Promise(function(t,i){var n={id:(new Date).getTime().toString(),data:o};s.tasks[n.id]=[t,i];n=new Blob([JSON.stringify(n)],{type:e});s.worker.postMessage(n)})},V.prototype.onMessage=function(t){var n,e=this;n=t.data,new Promise(function(t){var i=new FileReader;i.readAsText(n,"utf-8"),i.onload=function(){t(JSON.parse(i.result))}}).then(function(t){var i=e.tasks[t.id],n=i[0],i=i[1];0<Object.keys(t.data).length?n(t.data):i("not content"),delete e.tasks[t.id]})},V),w=(L.prototype.listener=function(t){this.subMotionEngine=this.source.subscribe(t)},L.prototype.complete=function(){var t;null===(t=this.subMotionEngine)||void 0===t||t.unsubscribe()},L),X=(R.prototype.smooth=function(t){var i=t*Math.PI/180,t=Math.sin(i),i=Math.cos(i);this.smoothData?(t=.6*this.smoothData.sin+.4*t,i=.6*this.smoothData.cos+.4*i):this.smoothData={sin:t,cos:i};i=180*Math.atan2(t,i)/Math.PI;return i<0&&(i+=360),i},R.prototype.listener=function(t){this.subOrientationEngine=this.source.subscribe(t)},R.prototype.complete=function(){var t;null===(t=this.subOrientationEngine)||void 0===t||t.unsubscribe()},R),k=(x.prototype.authDevicePermission=function(){return i(this,void 0,void 0,function(){var i;return m(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?[4,DeviceOrientationEvent.requestPermission()]:[3,2];case 1:return"granted"===t.sent()?(console.log("设备已授权动作和方向传感器"),this.status=!0,this.initEngine(),[2,{success:!0,msg:"设备已授权动作和方向传感器"}]):(console.error("授权失败: 设备未授权动作和方向传感器"),[2,{success:this.status=!1,msg:"授权失败: 设备未授权动作和方向传感器"}]);case 2:return this.status=!1,console.error("授权失败: 此浏览器没有动作和方向传感器的API, 惯导无法开启"),[2,{success:!1,msg:"授权失败: 此浏览器没有动作和方向传感器的API, 惯导无法开启"}];case 3:return i=t.sent(),this.status=!1,console.error("此浏览器没有动作和方向传感器的API, 惯导无法开启: \t",i),[2,{success:!1,msg:"授权失败: 惯导无法开启"}];case 4:return[2]}})})},x.prototype.initEngine=function(){var t;this.status&&(t=!1===this.options.openWorker,this.motionEngine=new w(t),this.orientationEngine=new X)},x.prototype.updateLocationData=function(t){this.locationData=JSON.parse(JSON.stringify(t))},x.prototype.updatePositionData=function(t){this.position=JSON.parse(JSON.stringify(t))},x.prototype.startMotionEngine=function(n){var t,e=this;this.status?null===(t=this.motionEngine)||void 0===t||t.listener(function(t){var i;if(e.motionState=t,null!==(t=e.locationData)&&void 0!==t&&t.position){if(!(i=e.computeMotionPosition(e.locationData.position)))return void console.warn("如果需要使用惯导, 请先使用'setPosition'设置的经纬度或者打开定位SDK服务");e.locationData.position=i,n("motion",{success:!0,data:e.locationData,msg:"惯性导航更新位置成功"})}e.position&&((i=e.computeMotionPosition(e.position))?(e.position=i,n("motion",{success:!0,data:e.position,msg:"惯性导航更新位置成功"})):console.warn("如果需要使用惯导, 请先使用'setPosition'设置的经纬度或者打开定位SDK服务"))}):n("error",{msg:"设备未授权动作和方向传感器",success:!1})},x.prototype.computeMotionPosition=function(t){if(null!==(i=this.motionState)&&void 0!==i&&i.walk&&this.orientationData){if(!t)return!1;var i=Z(t),t=this.orientationData*Math.PI/180;return W([i[0]+this.stepLong*Math.sin(t),i[1]+this.stepLong*Math.cos(t)])}return!1},x.prototype.startOrientationEngine=function(i){var t,n=this;this.status?null===(t=this.orientationEngine)||void 0===t||t.listener(function(t){n.orientationData=t,i("orientation",{msg:"方向传感器更新",data:t,success:!1})}):i("error",{msg:"设备未授权动作和方向传感器",success:!1})},x.prototype.endEngine=function(){var t;null===(t=this.orientationEngine)||void 0===t||t.complete(),null===(t=this.motionEngine)||void 0===t||t.complete()},x),M=(Y.prototype.forecast=function(t,i,n){var e=i/(i+this._R);return[t+e*(n-t),(1-e)*i]},Object.defineProperty(Y.prototype,"observations",{get:function(){return this._observations},set:function(t){this._observations=t},enumerable:!1,configurable:!0}),Y.prototype.update=function(t){if(!this._observations)return t;this._PX=this._PX+this._Q,this._PY=this._PY+this._Q;var i=this.forecast(t[0],this._PX,this._observations[0]),n=i[0],e=i[1],i=this.forecast(t[1],this._PY,this._observations[1]),t=i[0],i=i[1];return this._PX=e,this._PY=i,[n,t]},Y.prototype.reset=function(){this._PX=.1,this._PY=.1},Y),P=(G.prototype.getDistance=function(t,i,n,e){function o(t){return t*Math.PI/180}t=o(t),n=o(n),e=o(i)-o(e),e=2*Math.asin(Math.sqrt(Math.pow(Math.sin((t-n)/2),2)+Math.cos(t)*Math.cos(n)*Math.pow(Math.sin(e/2),2)));return e*=6378.137,Math.round(1e4*e)/1e4},G.prototype.startClearWalkStatus=function(t){var i=this;void 0===t&&(t=this.delayWalkTime),this.delayWalkStatus=!0,clearTimeout(this.ClearWalkStatusTimer),this.ClearWalkStatusTimer=setTimeout(function(){var t;null!==(t=null===(t=i.inertialNavigation)||void 0===t?void 0:t.motionState)&&void 0!==t&&t.walk&&(i.delayWalkStatus=!1)},t)},G.prototype.kalmanCompute=function(t){var i={floor_id:t.floor_id,block_id:t.block_id,position:t.smooth||t.stable||t.position};return this.locationRawData&&(i.floor_id!==this.locationRawData.floor_id&&this.kalman.reset(),this.kalman.observations=Z(i.position),t=this.kalman.update(Z(this.locationRawData.position)),i.position=W(t),null!==(t=this.locationRawData)&&void 0!==t&&t.position&&(this.locationRawData.position=i.position)),{success:!0,data:this.location=i,msg:"定位成功"}},G.prototype.getPositionData=function(o,s){var a;return i(this,void 0,void 0,function(){var i,n,e;return m(this,function(t){switch(t.label){case 0:return n=(i=s||{}).delayStopTime,n=void 0===n?1e4:n,i=void 0===(i=i.stopWalkingRefreshRange)?2:i,this.delayWalkTime=n,[4,this.service.getPosition(o)];case 1:return(n=t.sent())?(this.locationRawData=n,null!==(a=this.inertialNavigation)&&void 0!==a&&a.status&&this.locationRawData&&this.location&&(e=this.getDistance(this.location.position[0],this.location.position[1],n.position[0],n.position[1]))<i&&!this.delayWalkStatus?(console.warn('停止移动后更新位置的范围可以通过"stopWalkingRefreshRange"设置'),[2,{success:!1,msg:"位置本次更新"+e+"米, 但是人物已经停止移动且没有触发更新位置的范围"+i+"米"}]):[2,this.kalmanCompute(n)]):[2,{success:!1,msg:"定位中, 请查看控制台报错"}]}})})},G.prototype.onPosition=function(t,i,n){var e=this,o=(i=void 0===i?{}:i).delay,s=void 0===o?0:o,a=i.interval,o=void 0===a?1e3:a,a=i.delayStopTime,r=void 0===a?1e4:a,i=i.stopWalkingRefreshRange,c=void 0===i?2:i;this.onPositionCallback=n,this.subPosition=p.timer(s,o).pipe(h.switchMap(function(){return e.getPositionData(t,{delayStopTime:r,stopWalkingRefreshRange:c})})).subscribe(function(t){var i;t.success&&t.data&&(null===(i=e.inertialNavigation)||void 0===i||i.updateLocationData(t.data)),n&&n(t)})},G.prototype.stopPosition=function(){this.subPosition&&this.subPosition.unsubscribe()},G.prototype.setPosition=function(t){if(!this.inertialNavigation)return{success:!1,msg:"请先打开惯导服务"};this.inertialNavigation.updatePositionData(t)},G.prototype.startInertialNavigation=function(){return i(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.inertialNavigation?[3,2]:(this.inertialNavigation=new k(this.options.inertialNavigationOptions),[4,this.inertialNavigation.authDevicePermission()]);case 1:return[2,t.sent()];case 2:return this.inertialNavigation.status?[2,{success:!0,msg:"惯导服务已经开启了"}]:[2,{success:!1,msg:"动作和方向授权未打开"}];case 3:return[2]}})})},G.prototype.onInertialNavigation=function(n){var t,e=this;null===(t=this.inertialNavigation)||void 0===t||t.startMotionEngine(function(t,i){"motion"===t&&(e.startClearWalkStatus(),e.onPositionCallback&&e.onPositionCallback({data:i.data,msg:i.msg,success:!0}),n("motion",i))}),null===(t=this.inertialNavigation)||void 0===t||t.startOrientationEngine(n)},G.prototype.stopInertialNavigation=function(){var t;null===(t=this.inertialNavigation)||void 0===t||t.endEngine()},G);function G(t){this.options=t||{},this.kalman=new M;var i=t.openInertialNavigation,i=void 0!==i&&i;this.delayWalkStatus=!0,this.delayWalkTime=1e4,this.startClearWalkStatus(),this.service=new n(t),i&&this.startInertialNavigation().then().catch(function(t){return console.error(t)})}function Y(){this._Q=.01,this._R=.08,this._PX=.1,this._PY=.1}function x(t){void 0===t&&(t={}),this.stepLong=.5,this.status=!1,this.options=t}function R(){var o=this;this.LOW_ALPHA=.23;var t="IOS"==(/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)?"IOS":"Android")?"deviceorientation":"deviceorientationabsolute";this.source=p.fromEvent(window,t).pipe(h.throttleTime(100),h.map(function(t){var i=t.beta,n=t.gamma,e=t.alpha,t=t.webkitCompassHeading;return!(i&&n&&e)||60<Math.abs(i)||60<Math.abs(n)?1e3:o.smooth(t||360-e)}),h.filter(function(t){return t<=360}))}function L(t){var i=this;console.log("方向传感器"+(t?"关闭":"开启")+"了web-worker"),t||(this.worker=new S),this.source=p.fromEvent(window,"devicemotion").pipe(h.throttleTime(100),h.map(function(t){var i=t.acceleration,t=t.accelerationIncludingGravity;return i&&t?{acceleration:[i.x||0,i.y||0,i.z||0],accelerationGravity:[t.x||0,t.y||0,t.z||0],timestamp:(new Date).getTime()}:{acceleration:[0,0,0],accelerationGravity:[0,0,0],timestamp:(new Date).getTime()}}),h.mergeMap(function(t){return i.worker?i.worker.addTask("motion",t):a(t)}))}function V(){this.worker=new s,this.worker.onmessage=this.onMessage.bind(this),this.tasks=[]}t.default=P,Object.defineProperty(t,"__esModule",{value:!0})});
